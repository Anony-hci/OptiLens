<template>
    <div class="preference-panel">

        <!-- ÂøÖ‰øÆËØæËÆæÁΩÆ -->
        <div class="section"  v-if="currentPreference.requiredCourses.length > 0 || getPrioriModifiedCourses().length > 0 || currentPreference.objectives.length > 0 || filteredRegularConstraints.length > 0 || currentPreference.filteredConstraints.length > 0">
            <div class="section-title" v-if="false">
                <i class="section-icon">üìö</i>Course Setting
            </div>
            <div class="section-content" v-if="currentPreference && currentPreference.requiredCourses.length>0">
                <span  @click="toggleKey('requiredCourses')" class="clickable">
                    {{ currentPreference.requiredCourses.length }} required courses
                    <span class="toggle-icon">{{ isKeyExpanded('requiredCourses', 'list') ? '‚ñ≤' : '‚ñº' }}</span>
                </span>
                <div v-if="isKeyExpanded('requiredCourses')">
                    <div v-for="(course, index) in currentPreference.requiredCourses" :key="course" class="course-item">
                        <span class="course-content">{{ index + 1 }}. {{ course }}</span>
                        <button @click="removeRequiredCourse(course)" class="delete-course-btn" title="Âà†Èô§ÂøÖ‰øÆËØæ">
                            √ó
                        </button>
                    </div>
                </div>
            </div>
            <div class="section-content" v-if="currentPreference && getPrioriModifiedCourses().length > 0">
                <span  @click="toggleKey('coursePriority')" class="clickable">
                    {{ getPrioriModifiedCourses().length }} course priorities
                    <span class="toggle-icon">{{ isKeyExpanded('coursePriority', 'list') ? '‚ñ≤' : '‚ñº' }}</span>
                </span>
                <div v-if="isKeyExpanded('coursePriority')">
                    <div v-for="(course, index) in getPrioriModifiedCourses()" :key="course" class="course-item">
                        <span class="course-content">{{ index + 1 }}. {{ course['ËØæÁ®ãÂêç'] }}-({{ course['‰∏ªËÆ≤ÊïôÂ∏à'] }})-({{ course['‰∏äËØæÊó∂Èó¥'] }}): {{ course.priority }}‚≠êÔ∏è</span>
                        <button @click="removeCoursePriority(course)" class="delete-course-btn" title="Âà†Èô§ËØæÁ®ã‰ºòÂÖàÁ∫ß">
                            √ó
                        </button>
                    </div>
                </div>
            </div>
        
            <div class="section-content">
                <span v-if="currentPreference && (currentPreference.objectives.length > 0 || currentPreference.constraints.length > 0)" @click="toggleKey('constraints', 'section')" class="clickable">
                    {{ currentPreference.constraints.length + currentPreference.objectives.length }} conditions
                    <span class="toggle-icon">{{ isKeyExpanded('constraints', 'section') ? '‚ñ≤' : '‚ñº' }}</span>
                </span>
                <!-- ÁõÆÊ†áËÆæÁΩÆÂ≠êÈÉ®ÂàÜ -->
                <div class="subsection">
                    <div v-if="isKeyExpanded('constraints', 'section') && currentPreference && currentPreference.objectives && currentPreference.objectives.length > 0">
                        <div
                            v-for="objective in currentPreference.objectives"
                            :key="objective.name"
                            class="key-value-pair"
                        >
                            <div class="key filter-key">
                                <span class="key-text">{{ getPrefObjectiveKey(objective) }}</span>
                                
                                <span class="toggle-controls">
                                    
                                    <button @click="setWeight(objective)" class="weight-button" title="ËÆæÁΩÆÊùÉÈáç">
                                        ‚öñÔ∏è
                                    </button>
                                    <span class="toggle-icon" @click="toggleKey('objectives', objective.name); logToggleAction(objective.name)">
                                        {{ isKeyExpanded('objectives', objective.name) ? '‚ñ≤' : '‚ñº' }}
                                    </span>
                                    <button @click="handleObjectiveChange(objective)" class="delete-objective-btn" title="Âà†Èô§ÁõÆÊ†á">
                                        √ó
                                    </button>
                                </span>
                            </div>
                            <div class="value" v-if="isKeyExpanded('objectives', objective.name)">
                                <div v-html="getMathExpression(objective)"/>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Á∫¶ÊùüËÆæÁΩÆÂ≠êÈÉ®ÂàÜ -->
                <div class="subsection">
                    <div v-if="isKeyExpanded('constraints', 'section') && ((currentPreference && filteredRegularConstraints && filteredRegularConstraints.length > 0) || currentPreference.filteredConstraints.length > 0)">
                        <div
                            v-for="constraint in filteredRegularConstraints"
                            :key="constraint.name"
                            class="key-value-pair"
                        >
                            <div class="key filter-key">
                                
                                <!-- ÂØπ‰∫é‰∏çÂåÖÂê´"ÈÄâÊã©ËØæÁ®ã"ÁöÑÁ∫¶ÊùüÔºåÊòæÁ§∫ÂèØÁºñËæëÂ≠óÊÆµ -->
                                <div v-if="!constraint.name.includes('ÈÄâÊã©ËØæÁ®ã')" class="constraint-display-container">
                                    <!-- ÈªòËÆ§ÊòæÁ§∫ÁöÑÁ∫¶ÊùüÊèèËø∞ -->
                                    <span class="constraint-description">{{ constraint.name }} {{ getDisplayConstraintType(constraint) }} {{ getDisplayRhs(constraint) }}</span>
                                    
                                    <!-- hoverÊó∂ÊòæÁ§∫ÁöÑÂèØÁºñËæëÂ≠óÊÆµ -->
                                    <div class="constraint-edit-fields">
                                        <span class="constraint-name">{{ constraint.name.length > 30 ? constraint.name.slice(0, 30) + '‚Ä¶' : constraint.name }}</span>
                                        <div class="constraint-controls">
                                            <select 
                                                :value="getDisplayConstraintType(constraint)" 
                                                @change="handleConstraintValueChange(constraint, 'constraint_type', $event.target.value)"
                                                class="constraint-type-select"
                                                @click.stop
                                            >
                                                <option value="<=">‚â§</option>
                                                <option value=">=">‚â•</option>
                                                <option value="=">=</option>
                                            </select>
                                            <input 
                                                type="number" 
                                                :value="getDisplayRhs(constraint)" 
                                                @input="handleConstraintValueChange(constraint, 'rhs', $event.target.value)"
                                                @click.stop 
                                                class="constraint-rhs-input"
                                            />
                                        </div>
                                    </div>
                                </div>
                                <!-- ÂØπ‰∫éÂåÖÂê´"ÈÄâÊã©ËØæÁ®ã"ÁöÑÁ∫¶ÊùüÔºåÊòæÁ§∫ÂéüÊúâÁöÑkey-text -->
                                <span v-else class="key-text">{{ getPrefConstraintKey(constraint) }}</span>
                                <span class="toggle-controls">
                                    <span class="toggle-icon" @click="toggleKey('constraints', constraint.name); logToggleAction(constraint.name)">
                                    {{ isKeyExpanded('constraints', constraint.name) ? '‚ñ≤' : '‚ñº' }}
                                    </span>
                                    <button @click="handleConstraintChange(constraint)" class="delete-constraint-btn" title="Âà†Èô§Á∫¶Êùü">√ó</button>
                                </span>
                            </div>
                            <div class="value" v-if="isKeyExpanded('constraints', constraint.name)">
                                <div v-html="getMathExpression(constraint)"/>
                            </div>
                        </div>
                        <div
                            v-for="constraint in currentPreference.filteredConstraints"
                            :key="constraint.name"
                            class="key-value-pair"
                        >
                            <div class="key filter-key">
                                <!-- ÂØπ‰∫éfilteredConstraintsÔºåÊòæÁ§∫Áªü‰∏ÄÁöÑhoverÁºñËæëÁïåÈù¢ -->
                                <div class="constraint-display-container">
                                    <!-- ÈªòËÆ§ÊòæÁ§∫ÁöÑÁ∫¶ÊùüÊèèËø∞ -->
                                    <span class="constraint-description">{{ getFilteredConstraintKey(constraint) }}</span>
                                    
                                    <!-- hoverÊó∂ÊòæÁ§∫ÁöÑÂèØÁºñËæëÂ≠óÊÆµÔºàÂ¶ÇÊûúapplicableÔºâ -->
                                    <div v-if="constraint.filter_type === 'feature'" class="constraint-edit-fields">
                                        <span class="constraint-name">{{ constraint.name }}</span>
                                        <div class="constraint-controls">
                                            <select 
                                                v-model="constraint.constraint_type" 
                                                @change="handleFilteredConstraintValueChange(constraint, 'constraint_type')"
                                                class="constraint-type-select"
                                                @click.stop
                                            >
                                                <option value="<=">‚â§</option>
                                                <option value=">=">‚â•</option>
                                                <option value="=">=</option>
                                            </select>
                                            <input 
                                                type="number" 
                                                v-model="constraint.rhs" 
                                                @input="handleFilteredConstraintValueChange(constraint, 'rhs')"
                                                @click.stop 
                                                class="constraint-rhs-input"
                                            />
                                        </div>
                                    </div>
                                    <!-- ÂØπ‰∫éÈÄâÊã©ËØæÁ®ãÁ±ªÂûãÁöÑfilteredConstraintsÔºåÂè™ÊòæÁ§∫ÊèèËø∞ -->
                                    <div v-else class="constraint-edit-fields">
                                        <span class="constraint-name">{{ getFilteredConstraintKey(constraint) }}</span>
                                    </div>
                                </div>
                                
                                <span class="toggle-controls">
                                    <span class="toggle-icon" @click="toggleKey('filteredConstraints', constraint.name); logToggleAction(constraint.name)">
                                    {{ isKeyExpanded('filteredConstraints', constraint.name) ? '‚ñ≤' : '‚ñº' }}
                                    </span>
                                    <button @click="toggleConstraint(constraint)" class="delete-constraint-btn" title="Âà†Èô§Á∫¶Êùü">√ó</button>
                                </span>
                            </div>
                            <div class="value" v-if="isKeyExpanded('filteredConstraints', constraint.name)">
                                <div v-html="getMathExpression(constraint)"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ê±ÇËß£ÁªìÊûú -->
        <div class="section result-section" v-if="false">
            <div class="section-title clickable" @click="toggleKey('results', 'section')">
                <i class="section-icon">üìä</i>Results
                <span class="toggle-icon">{{ isKeyExpanded('results', 'section') ? '‚ñ≤' : '‚ñº' }}</span>
            </div>
            <div v-if="isKeyExpanded('results', 'section')" class="solution-count">
                <span v-html="formattedDescription(currentPreference)"></span>
            </div>
        </div>

        <!-- Êìç‰ΩúÊåâÈíÆ -->
        <div class="button-container">
            <button @click="solving" class="action-button solve-button">
                <!-- <img src="../assets/solve.svg" alt="solve" class="button-icon" /> -->
                <span>üîç  Find Solutions</span>
            </button>
        </div>
    </div>
</template>

<script setup>
import { isKeyExpanded, toggleKey, getConstraintKey, getConstraintValue, getObjectiveKey, getObjectiveValue, getFilteredConstraintKey, getMathExpression, getPrefObjectiveKey, getPrefConstraintKey, expandedKeys } from '../logic/keyService';
import { currentPreference, getPrioriModifiedCourses } from '../logic/preferenceService';
import { formattedDescription, getFeatureDisplay, solving } from '../logic/modelNodeService';
import { confirmSolution, applyFilter, filters } from '../logic/solutionService';
import { toggleConstraint, handleObjectiveChange, handleConstraintChange } from '../logic/modifiedPanelService';
import { logUserAction, ACTION_TYPES } from '../logic/userActionLogService';
import { computed, onMounted } from 'vue';
import { addUserMessage } from '../logic/messageService';

// ËÆæÁΩÆÈªòËÆ§Â±ïÂºÄÁä∂ÊÄÅ
onMounted(() => {
  // ÈªòËÆ§Â±ïÂºÄobjectives„ÄÅconstraintsÂíåresultsËøô‰∏â‰∏™section
  expandedKeys.value.add('objectives-section');
  expandedKeys.value.add('constraints-section');
  expandedKeys.value.add('results-section');
});

const logToggleAction = (name) => {
  logUserAction(ACTION_TYPES.TOGGLE_CONDITION, {
    conditionName: name,
    new_state: isKeyExpanded('objectives', name) || isKeyExpanded('constraints', name) || isKeyExpanded('filteredConstraints', name) ? 'expand' : 'collapse',
  });
};

// ËÆ°ÁÆóÂ±ûÊÄßÔºöËøáÊª§ÊéâÂ∑≤Â≠òÂú®‰∫éfilteredConstraints‰∏≠ÁöÑÁ∫¶Êùü
const filteredRegularConstraints = computed(() => {
  if (!currentPreference.value || !currentPreference.value.constraints) {
    return [];
  }
  
  // Ëé∑ÂèñfilteredConstraints‰∏≠ÊâÄÊúâÁöÑname
  const filteredConstraintNames = currentPreference.value.filteredConstraints.map(fc => fc.name);
  
  // ËøáÊª§ÊéâÂ∑≤Â≠òÂú®‰∫éfilteredConstraints‰∏≠ÁöÑÁ∫¶Êùü
  return currentPreference.value.constraints.filter(constraint => 
    !filteredConstraintNames.includes(constraint.name)
  );
});

// Âà†Èô§ËØæÁ®ã‰ºòÂÖàÁ∫ßÁöÑÊñπÊ≥ï
const removeCoursePriority = (course) => {
    course.priority = 3;
    course.priority_type = 'default';
    updatePreferenceCoursesChange(course, 'rating', { rating: 3 });
    logUserAction(ACTION_TYPES.REMOVE_COURSE_PRIORITY, {
      course: course,
    });
  };

// Âà†Èô§ÂøÖ‰øÆËØæÁ®ãÁöÑÊñπÊ≥ï
const removeRequiredCourse = (course) => {
  // ÊòæÁ§∫Á°ÆËÆ§ÂØπËØùÊ°Ü
  if (confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ÂøÖ‰øÆËØæÁ®ã"${course}"ÂêóÔºüÂà†Èô§ÂêéËØ•ËØæÁ®ãÂ∞Ü‰∏çÂÜç‰Ωú‰∏∫ÂøÖ‰øÆËØæË¶ÅÊ±Ç„ÄÇ`)) {
    // ‰ªé currentPreference.requiredCourses ‰∏≠ÁßªÈô§ÊåáÂÆöËØæÁ®ã
    const index = currentPreference.value.requiredCourses.indexOf(course);
    if (index > -1) {
      currentPreference.value.requiredCourses.splice(index, 1);
      
      // ËÆ∞ÂΩïÁî®Êà∑Âà†Èô§ÂøÖ‰øÆËØæÁ®ãÁöÑÊìç‰Ωú
      logUserAction(ACTION_TYPES.REMOVE_REQUIRED_COURSE, {
        course: course,
      });
      addUserMessage(`Delete required course: ${course}`);
      console.log(`Â∑≤Âà†Èô§ÂøÖ‰øÆËØæÁ®ã: ${course}ÔºåÂâ©‰ΩôÂøÖ‰øÆËØæÁ®ãÊï∞Èáè: ${currentPreference.value.requiredCourses.length}`);
    }
  }
};

// ËÆæÁΩÆÊùÉÈáçÁöÑÊñπÊ≥ï
const setWeight = (objective) => {
  const currentWeight = objective.weight || 1;
  const newWeight = prompt(`ËØ∑ËæìÂÖ• "${getPrefObjectiveKey(objective)}" ÁöÑÊùÉÈáçÔºàÂΩìÂâçÊùÉÈáçÔºö${currentWeight}Ôºâ:`, currentWeight);
  
  if (newWeight !== null && !isNaN(newWeight) && newWeight > 0) {
    objective.weight = parseFloat(newWeight);
    
    // ËÆ∞ÂΩïÁî®Êà∑ËÆæÁΩÆÊùÉÈáçÁöÑÊìç‰Ωú
    logUserAction(ACTION_TYPES.SET_OBJECTIVE_WEIGHT, {
      objective: objective.name,
      weight: objective.weight
    });
    addUserMessage(`Update objective ${objective.name} weight to: ${objective.weight}`);
    console.log(`Â∑≤ËÆæÁΩÆÁõÆÊ†á ${objective.name} ÁöÑÊùÉÈáç‰∏∫: ${objective.weight}`);

  } else if (newWeight !== null) {
    alert('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊ≠£Êï∞ÊùÉÈáçÔºÅ');
  }
};

// Â§ÑÁêÜÁ∫¶ÊùüÂÄºÂèòÊõ¥ÁöÑÊñπÊ≥ï
const handleConstraintValueChange = (constraint, fieldType, newValue) => {
  // ËÆ∞ÂΩïÁ∫¶ÊùüÂèòÊõ¥Êìç‰Ωú
  logUserAction(ACTION_TYPES.MODIFY_CONSTRAINT, {
    constraint_name: constraint.name,
    fieldType: fieldType,
    newValue: newValue
  });
  
  // Ëß¶ÂèëÈáçÊñ∞Ê±ÇËß£ÊàñÊõ¥Êñ∞Áõ∏ÂÖ≥ÈÄªËæë
  console.log(`Á∫¶Êùü ${constraint.name} ÁöÑ ${fieldType} Â∑≤Êõ¥Êñ∞‰∏∫: ${newValue}`);
  addUserMessage(`Update ${fieldType} of constraint ${constraint.name} to: ${newValue}`);
  
  // Â∞ÜÁ∫¶ÊùüÊò†Â∞ÑÂà∞Á≠õÈÄâÊù°‰ª∂Ôºà‰∏ç‰øÆÊîπÂéüconstraintÔºâ
  const constraintTypeToOperation = {
    '<=': 'lessThanOrEqual',
    '>=': 'greaterThanOrEqual', 
    '=': 'equal'
  };
  
  // Ëé∑ÂèñÁâπÂæÅÂêçÔºàÁ∫¶ÊùüÁöÑnameÂ≠óÊÆµÔºâ
  const featureName = constraint.name;
  
  // Ëé∑ÂèñÂΩìÂâçÁöÑÁ∫¶ÊùüÁ±ªÂûãÂíåÂÄºÔºà‰ºòÂÖà‰ªéfilters‰∏≠Ëé∑ÂèñÔºåÂê¶Âàô‰ªéÂéüconstraintËé∑ÂèñÔºâ
  const currentConstraintType = getDisplayConstraintType(constraint);
  const currentRhs = getDisplayRhs(constraint);
  
  // ÂàõÂª∫ÊàñÊõ¥Êñ∞ÂØπÂ∫îÁöÑÁ≠õÈÄâÊù°‰ª∂ 
  if (!filters.value[featureName]) {
    // ÂàõÂª∫Êñ∞ÁöÑÁ≠õÈÄâÊù°‰ª∂
    filters.value[featureName] = {
      operation: fieldType === 'constraint_type' ? 
        constraintTypeToOperation[newValue] : 
        constraintTypeToOperation[currentConstraintType] || 'equal',
      value: fieldType === 'rhs' ? newValue : currentRhs
    };
  } else {
    // Êõ¥Êñ∞Áé∞ÊúâÁöÑÁ≠õÈÄâÊù°‰ª∂
    if (fieldType === 'constraint_type') {
      filters.value[featureName].operation = constraintTypeToOperation[newValue] || 'equal';
    } else if (fieldType === 'rhs') {
      filters.value[featureName].value = newValue;
    }
  }
  
  console.log(`Â∑≤Â∞ÜÁ∫¶ÊùüÊò†Â∞ÑÂà∞Á≠õÈÄâÊù°‰ª∂: ${featureName} ${filters.value[featureName].operation} ${filters.value[featureName].value}`);
  // Á´ãÂç≥Â∫îÁî®Á≠õÈÄâÊù°‰ª∂
  applyFilter();
};

// Â§ÑÁêÜfilteredConstraintsÁöÑÂÄºÂèòÊõ¥ÊñπÊ≥ï
const handleFilteredConstraintValueChange = (constraint, fieldType) => {
  // ËÆ∞ÂΩïÁ∫¶ÊùüÂèòÊõ¥Êìç‰Ωú
  logUserAction(ACTION_TYPES.MODIFY_CONSTRAINT, {
    constraint_name: constraint.name,
    fieldType: fieldType,
    newValue: fieldType === 'constraint_type' ? constraint.constraint_type : constraint.rhs
  });

  // Ëß¶ÂèëÈáçÊñ∞Ê±ÇËß£ÊàñÊõ¥Êñ∞Áõ∏ÂÖ≥ÈÄªËæë
  console.log(`Á≠õÈÄâÁ∫¶Êùü ${constraint.name} ÁöÑ ${fieldType} Â∑≤Êõ¥Êñ∞‰∏∫: ${fieldType === 'constraint_type' ? constraint.constraint_type : constraint.rhs}`);

  // Â∞ÜÁ∫¶ÊùüÊò†Â∞ÑÂà∞Á≠õÈÄâÊù°‰ª∂
  const constraintTypeToOperation = {
    '<=': 'lessThanOrEqual',
    '>=': 'greaterThanOrEqual', 
    '=': 'equal'
  };

  // Ëé∑ÂèñÁâπÂæÅÂêçÔºàÁ∫¶ÊùüÁöÑnameÂ≠óÊÆµÔºâ
  const featureName = constraint.name;

  // Áõ¥Êé•Êõ¥Êñ∞Á≠õÈÄâÊù°‰ª∂ÔºàfilteredConstraintÊú¨Ë∫´Â∞±ÊòØÂü∫‰∫éfiltersÁîüÊàêÁöÑÔºâ
  if (!filters.value[featureName]) {
    filters.value[featureName] = {
      operation: constraintTypeToOperation[constraint.constraint_type] || 'equal',
      value: constraint.rhs
    };
  } else {
    // Êõ¥Êñ∞Áé∞ÊúâÁöÑÁ≠õÈÄâÊù°‰ª∂
    if (fieldType === 'constraint_type') {
      filters.value[featureName].operation = constraintTypeToOperation[constraint.constraint_type] || 'equal';
    } else if (fieldType === 'rhs') {
      filters.value[featureName].value = constraint.rhs;
    }
  }

  console.log(`Â∑≤Â∞ÜÁ≠õÈÄâÁ∫¶ÊùüÊò†Â∞ÑÂà∞Á≠õÈÄâÊù°‰ª∂: ${featureName} ${filters.value[featureName].operation} ${filters.value[featureName].value}`);

  // Á´ãÂç≥Â∫îÁî®Á≠õÈÄâÊù°‰ª∂
  applyFilter();
};

// Ëé∑ÂèñÁ∫¶ÊùüÂ∫îËØ•ÊòæÁ§∫ÁöÑconstraint_typeÔºà‰ºòÂÖàÊòæÁ§∫filteredConstraint‰∏≠ÁöÑÂÄºÔºâ
const getDisplayConstraintType = (constraint) => {
  const featureName = constraint.name;
  if (filters.value[featureName]) {
    // ‰ªéoperationÂèçÊé®constraint_type
    const operationToConstraintType = {
      'lessThanOrEqual': '<=',
      'greaterThanOrEqual': '>=',
      'equal': '='
    };
    return operationToConstraintType[filters.value[featureName].operation] || constraint.constraint_type;
  }
  const map = {
    '==': '=',
  }
  return map[constraint.constraint_type] || constraint.constraint_type;
};

// Ëé∑ÂèñÁ∫¶ÊùüÂ∫îËØ•ÊòæÁ§∫ÁöÑrhsÂÄºÔºà‰ºòÂÖàÊòæÁ§∫filteredConstraint‰∏≠ÁöÑÂÄºÔºâ
const getDisplayRhs = (constraint) => {
  const featureName = constraint.name;
  if (filters.value[featureName]) {
    return filters.value[featureName].value;
  }
  return constraint.rhs;
};
</script>

<style scoped>
.preference-panel {
    padding: 5px;
    border: 1px solid #eee;
    background-color: #fff;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    /* margin-bottom: 20px; */
}

.panel-header {
    margin-bottom: 20px;
    text-align: center;
}

.panel-header h2 {
    color: #4a6fa5;
    margin-bottom: 8px;
    font-size: 1.5rem;
}

.panel-description {
    color: #666;
    font-size: 0.9rem;
}

.section {
    margin-bottom: 6px;
    border-radius: 6px;
    overflow: hidden;
    background-color: #f9f9f9;
    border: 1px solid #eee;
}

.section-title {
    font-weight: bold;
    color: #4a6fa5;
    padding: 5px 15px;
    background-color: #f0f7ff;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    align-items: center;
}

.section-icon {
    margin-right: 8px;
    font-style: normal;
}

.modified-title {
    background-color: #f0f7ff;
    color: #1a73e8;
}

.section-content {
    padding: 6px;
}

.subsection {
    margin-bottom: 0px;
}

.subsection:last-child {
    margin-bottom: 0;
}

.subsection-title {
    font-weight: 600;
    color: #4a6fa5;
    font-size: 0.8rem;
    background-color: #f8f9fa;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 12px;
    transition: all 0.2s ease;
}

.subsection-title.clickable {
    cursor: pointer;
}

.subsection-title.clickable:hover {
    background-color: #e6f0ff;
    color: #1a73e8;
}

.subsection-title .toggle-icon {
    font-size: 12px;
    transition: transform 0.2s ease;
}

.empty-message {
    color: #999;
    font-style: italic;
    padding: 10px 0;
    text-align: center;
}

.clickable {
    cursor: pointer;
    color: #4a6fa5;
    font-weight: bold;
    display: block;
    margin: 5px 0;
    transition: color 0.2s;
}

.clickable:hover {
    color: #1a73e8;
}

.toggle-icon {
    margin-left: 5px;
    font-size: 0.8em;
}

.key-value-pair {
    margin: 1px 0;
    padding-bottom: 0px;
}

.key-value-pair:last-child {
    border-bottom: none;
}

.key {
    display: flex;
    align-items: center;
    font-weight: 500;
    padding: 5px 0;
}

.filter-key {
    cursor: default;
    padding: 8px 12px;
    border-radius: 4px;
    background-color: #f0f7ff;
    transition: background-color 0.2s;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 56px; /* Âõ∫ÂÆöÈ´òÂ∫¶ÔºåÂåÖÂê´padding */
    box-sizing: border-box; /* Á°Æ‰øùpaddingÂåÖÂê´Âú®È´òÂ∫¶ÂÜÖ */
}

.filter-key:hover {
    background-color: #e0f0ff;
}

.filter-checkbox {
    margin-right: 10px;
}

.filter-text {
    flex: 1;
    color: #1a73e8;
}

.key-text {
    color: #1a73e8;
    text-align: left;
    flex: 1;
    font-weight: 500;
}

.weight-button {
    background-color: #f0f7ff;
    border: none;
    color: #1a73e8;
    border-radius: 4px;
    padding: 0px 0px;
    margin: 0 0px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s ease;
    height: 28px;
    min-width: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.weight-button:hover {
    background-color: #e0f0ff;
    border-color: #0d62d0;
    color: #0d62d0;
}

.toggle-controls {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: auto;
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s ease;
}

/* Áªü‰∏ÄhoverÊïàÊûúÔºöhoverÂà∞Êï¥‰∏™key-value-pairÊó∂ÂêåÊó∂ÊòæÁ§∫ÁºñËæëÂ≠óÊÆµÂíåtoggle-controls */
.key-value-pair:hover .toggle-controls {
    opacity: 1;
    visibility: visible;
    /* ‰øùÊåÅmargin-left: autoÔºåËÆ©ÊåâÈíÆ‰øùÊåÅÂú®Âè≥‰æß */
}

.key-value-pair:hover .constraint-edit-fields {
    margin-left: 0px;
    opacity: 1;
    visibility: visible;
}

.key-value-pair:hover .constraint-description {
    opacity: 0;
    visibility: hidden;
}

.toggle-icon {
    cursor: pointer;
    font-size: 14px;
    color: #666;
    padding: 4px 8px;
    border-radius: 4px;
    transition: all 0.2s ease;
}

.toggle-icon:hover {
    background-color: #f0f0f0;
    color: #1a73e8;
}

.delete-objective-btn, .delete-constraint-btn {
    background-color: #ff4d4f;
    color: white;
    border: none;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    opacity: 0.8;
}

.delete-objective-btn:hover {
    background-color: #ff7875;
    opacity: 1;
    box-shadow: 0 2px 4px rgba(255, 77, 79, 0.3);
}

.delete-objective-btn:active {
    /* ÁßªÈô§activeÁä∂ÊÄÅÁöÑÁº©Â∞èÊïàÊûú */
}

.value {
    margin-top: 4px;
    margin-left: 28px;
    color: #666;
    font-size: 0.9em;
    background-color: #f5f5f5;
    padding: 8px;
    border-radius: 4px;
}

.course-item {
    padding: 8px 10px;
    margin: 5px 0;
    background-color: #f5f5f5;
    border-radius: 4px;
    border-left: 3px solid #4a6fa5;
    display: flex; /* Added for delete button alignment */
    align-items: center; /* Added for delete button alignment */
    transition: all 0.2s ease; /* Add smooth transition */
}

.course-item:hover {
    background-color: #eef4ff; /* Light blue background on hover */
    border-left-color: #1a73e8; /* Change border color on hover */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Add subtle shadow */
}

.course-item:hover .delete-course-btn {
    opacity: 1; /* Show delete button more prominently on course item hover */
}

.course-content {
    flex: 1; /* Allow content to take available space */
    margin-right: 10px; /* Space between content and button */
}

.delete-course-btn {
    background-color: #ff4d4f; /* Red color for delete button */
    color: white;
    border: none;
    border-radius: 50%; /* Make it a circle */
    width: 24px;
    height: 24px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    flex-shrink: 0; /* Prevent shrinking */
    opacity: 0.8; /* Slightly transparent by default */
}

.delete-course-btn:hover {
    background-color: #ff7875; /* Darker red on hover */
    opacity: 1; /* Full opacity on hover */
    box-shadow: 0 2px 4px rgba(255, 77, 79, 0.3); /* Add shadow on hover */
}

.result-section {
    background-color: #f0f7ff;
}

.solution-count {
    padding: 15px;
    background-color: #fff;
    border-radius: 5px;
    border-left: 4px solid #4a6fa5;
    margin: 10px;
    font-size: 0.9rem;
}

.button-container {
    display: flex;
    justify-content: center;
    margin-top: 5px;
}


.save-button {
    background-color: #4a6fa5;
}

.solve-button {
    background-color: #1a73e8;
    max-width: 200px;
}

.solve-button:hover {
    background-color: #0d62d0;
}

.action-button {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: flex-start; /* Êîπ‰∏∫Â∑¶ÂØπÈΩê */
    padding: 12px 15px;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    position: relative; /* Ê∑ªÂä†Áõ∏ÂØπÂÆö‰Ωç */
    height: 27px;
}

.button-icon {
    width: 20px;
    height: 20px;
    margin-right: 10px; 
    margin-left: 50px; /* ÁßªÈô§Â∑¶ËæπË∑ù */
}

.action-button span {
    position: absolute; /* ÁªùÂØπÂÆö‰Ωç */
    left: 0;
    right: 0;
    text-align: center; /* ÊñáÊú¨Â±Ö‰∏≠ */
    margin-left: 0px;   
}

.action-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.constraint-display-container {
    display: flex;
    align-items: center;
    /* ÁßªÈô§justify-contentËÆæÁΩÆÔºåËÆ©ÂÆÉËá™ÁÑ∂Â°´ÂÖÖÁ©∫Èó¥ */
    gap: 10px;
    /* ÁßªÈô§ margin-leftÔºåËÆ©ÂÜÖÂÆπ‰ªéÊúÄÂ∑¶ËæπÂºÄÂßã */
    position: relative;
    height: 38px; /* ‰∏éfilter-keyÁöÑ56pxÈÖçÂêà */
    overflow: hidden; /* Èò≤Ê≠¢ÂÜÖÂÆπÊ∫¢Âá∫ */
    flex: 1; /* Âç†ÊçÆÂèØÁî®Á©∫Èó¥ */
}

.constraint-description {
    /* Âç†ÊçÆÂèØÁî®Á©∫Èó¥Âπ∂Â∑¶ÂØπÈΩê */
    font-weight: 500;
    color: #1a73e8;
    transition: opacity 0.2s ease;
    text-align: left; /* Á°Æ‰øùÊñáÊú¨Â∑¶ÂØπÈΩê */
    width: 100%; /* Á°Æ‰øùÂç†ÊçÆÊï¥‰∏™ÂÆπÂô®ÂÆΩÂ∫¶ */
}

/* ÈªòËÆ§ÈöêËóèÁºñËæëÂ≠óÊÆµ */
.constraint-edit-fields {
    display: flex;
    align-items: center;
    justify-content: flex-start; /* ÁºñËæëÂ≠óÊÆµÂÜÖÈÉ®ÂêëÂ∑¶ÂØπÈΩê */
    gap: 10px;
    opacity: 0;
    visibility: hidden;
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    transition: opacity 0.2s ease, visibility 0.2s ease;
}

/* hoverÊó∂ÊòæÁ§∫ÁºñËæëÂ≠óÊÆµÔºåÈöêËóèÊèèËø∞ */
.constraint-display-container:hover .constraint-description {
    opacity: 0;
    visibility: hidden;
}

.constraint-display-container:hover .constraint-edit-fields {
    opacity: 1;
    visibility: visible;
}

.constraint-name {
    /* ÁßªÈô§flex: 1ÔºåËÆ©ÂÆÉÂè™Âç†ÊçÆÈúÄË¶ÅÁöÑÁ©∫Èó¥ */
    font-weight: 500;
    color: #1a73e8;
    text-align: left; /* Á°Æ‰øùÁ∫¶ÊùüÂêçÁß∞Â∑¶ÂØπÈΩê */
    white-space: nowrap; /* Èò≤Ê≠¢Á∫¶ÊùüÂêçÁß∞Êç¢Ë°å */
}

.constraint-controls {
    display: flex;
    align-items: center;
    justify-content: flex-start; /* Á°Æ‰øùÊéß‰ª∂ÂêëÂ∑¶ÂØπÈΩê */
    gap: 8px;
    /* ‰∏çËÆæÁΩÆmargin-left: autoÔºåËÆ©ÂÆÉÁ¥ßË∑üÂú®constraint-nameÂêéÈù¢ */
}

.constraint-type-select,
.constraint-rhs-input {
    padding: 6px 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 0.9em;
    color: #333;
    background-color: #fff;
    min-width: 60px;
    text-align: left; /* Êîπ‰∏∫Â∑¶ÂØπÈΩê */
}

.constraint-type-select:focus,
.constraint-rhs-input:focus {
    outline: none;
    border-color: #1a73e8;
}

.constraint-type-select {
    cursor: pointer;
}

.constraint-rhs-input {
    width: 60px;
    cursor: text;
}

</style>